<!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Apache Flink 1.8-SNAPSHOT Documentation: Elasticsearch Connector</title>
    <link rel="shortcut icon" href="//ci.apache.org/projects/flink/flink-docs-master/page/favicon.ico" type="image/x-icon">
    <link rel="icon" href="//ci.apache.org/projects/flink/flink-docs-master/page/favicon.ico" type="image/x-icon">
    <link rel="canonical" href="//ci.apache.org/projects/flink/flink-docs-stable/dev/connectors/elasticsearch.html">

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <link rel="stylesheet" href="//ci.apache.org/projects/flink/flink-docs-master/page/css/flink.css">
    <link rel="stylesheet" href="//ci.apache.org/projects/flink/flink-docs-master/page/css/syntax.css">
    <link rel="stylesheet" href="//ci.apache.org/projects/flink/flink-docs-master/page/css/codetabs.css">
    <link rel="stylesheet" href="//ci.apache.org/projects/flink/flink-docs-master/page/font-awesome/css/font-awesome.min.css">
    
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    

    <!-- Main content. -->
    <div class="container">
      
      <div class="row">
        <div class="col-lg-3" id="sidenavcol">
          







  
    
    
    
      
    
  

  
    
    
    
      
    
  

  
    
    
    
      
    
  

  
    
    
    
      













<div class="sidenav-logo">
  <p><a href="//ci.apache.org/projects/flink/flink-docs-master"><img class="bottom" alt="Apache Flink" src="//ci.apache.org/projects/flink/flink-docs-master/page/img/navbar-brand-logo.jpg"></a> v1.8-SNAPSHOT</p>
</div>
<ul id="sidenav">

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/"><i class="fa fa-home title" aria-hidden="true"></i> Home</a></li>
    
  

  
    

    

    
    
    

    <hr class="section-break"></hr>

    
    
      
      
        
        
<li><a href="#collapse-2" data-toggle="collapse"><i class="fa fa-map-o title appetizer" aria-hidden="true"></i> Concepts <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-2"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
      
      
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/concepts/programming-model.html">Programming Model</a></li>
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/concepts/runtime.html">Distributed Runtime</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-6" data-toggle="collapse"><i class="fa fa-power-off title appetizer" aria-hidden="true"></i> Tutorials <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-6"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-7" data-toggle="collapse">API Tutorials <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-7"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/tutorials/datastream_api.html">DataStream API</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-10" data-toggle="collapse">Setup Tutorials <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-10"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/tutorials/local_setup.html">本地安装</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/tutorials/flink_on_windows.html">在Windows上运行Flink</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-15" data-toggle="collapse"><i class="fa fa-file-code-o title appetizer" aria-hidden="true"></i> Examples <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-15"><ul>
  <li><a href="//ci.apache.org/projects/flink/flink-docs-master/examples/">概览</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/batch/examples.html">批处理案例</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    <hr class="section-break"></hr>

    
    
      
      
        
        
<li><a href="#collapse-18" data-toggle="collapse" class="active"><i class="fa fa-code title maindish" aria-hidden="true"></i> Application Development</a><div class="collapse in" id="collapse-18"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-19" data-toggle="collapse">Project Build Setup <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-19"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/projectsetup/java_api_quickstart.html">Project Template for Java</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/projectsetup/scala_api_quickstart.html">Project Template for Scala</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/projectsetup/dependencies.html">Configuring Dependencies, Connectors, Libraries</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-24" data-toggle="collapse">Basic API Concepts <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-24"><ul>
  <li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/api_concepts.html">概览</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/scala_api_extensions.html">Scala API Extensions</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/java_lambdas.html">Java Lambda Expressions</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-28" data-toggle="collapse" class="active">Streaming (DataStream API)</a><div class="collapse in" id="collapse-28"><ul>
  <li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/datastream_api.html">概览</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-29" data-toggle="collapse">事件时间<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-29"><ul>
  <li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/event_time.html">概览</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/event_timestamps_watermarks.html">生成时间戳/水印</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/event_timestamp_extractors.html">预定义的时间戳提取器/水印发射器</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-33" data-toggle="collapse">状态&容错<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-33"><ul>
  <li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/stream/state/">概览</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/stream/state/state.html">使用状态</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/stream/state/broadcast_state.html">广播状态模式</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/stream/state/checkpointing.html">检查点机制</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/stream/state/queryable_state.html">可查询状态</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/stream/state/state_backends.html">状态后端</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/stream/state/schema_evolution.html">状态Schema演进</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/stream/state/custom_serialization.html">自定义状态序列化</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-42" data-toggle="collapse">Operators <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-42"><ul>
  <li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/stream/operators/">概览</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
      
      
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/stream/operators/windows.html">窗口</a></li>
      
    
  

  
    

    

    
    
    

    

    
    
      
      
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/stream/operators/joining.html">Joining</a></li>
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/stream/operators/process_function.html">过程函数</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/stream/operators/asyncio.html">异步I/O</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-48" data-toggle="collapse" class="active">连接器</a><div class="collapse in" id="collapse-48"><ul>
  <li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/connectors/">概览</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/connectors/guarantees.html">容错性保证</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/connectors/kafka.html">Kafka</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/connectors/cassandra.html">Cassandra</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/connectors/kinesis.html">Kinesis</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/connectors/elasticsearch.html" class="active">Elasticsearch</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/connectors/filesystem_sink.html">滚动文件接收器</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/connectors/streamfile_sink.html">流文件接收器</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/connectors/rabbitmq.html">RabbitMQ</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/connectors/nifi.html">NiFi</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/connectors/twitter.html">Twitter</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/stream/side_output.html">旁侧输出</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/stream/python.html">Python API</a></li>
    
  

  
    

    

    
    
    

    

    
    
      
      
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/stream/testing.html">测试</a></li>
      
    
  

  
    

    

    
    
    

    

    
    
      
      
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/stream/experimental.html">实验性功能</a></li>
      
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-65" data-toggle="collapse">Batch (DataSet API) <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-65"><ul>
  <li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/batch/">概览</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/batch/dataset_transformations.html">转换</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/batch/fault_tolerance.html">容错</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/batch/zip_elements_guide.html">Zipping Elements</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/batch/iterations.html">迭代</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/batch/python.html">Python API</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/batch/connectors.html">连接器</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/batch/hadoop_compatibility.html">Hadoop兼容性</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/local_execution.html">本地执行</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/cluster_execution.html">集群执行</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-76" data-toggle="collapse">Table API & SQL <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-76"><ul>
  <li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/table/">概览</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/table/common.html">概念&通用API</a></li>
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-78" data-toggle="collapse">Streaming Concepts <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-78"><ul>
  <li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/table/streaming/">概览</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/table/streaming/dynamic_tables.html">Dynamic Tables</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/table/streaming/time_attributes.html">Time Attributes</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/table/streaming/joins.html">Joins in Continuous Queries</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/table/streaming/temporal_tables.html">Temporal Tables</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/table/streaming/match_recognize.html">Detecting Patterns</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/table/streaming/query_configuration.html">Query Configuration</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/table/connect.html">连接外部系统</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/table/tableApi.html">Table API</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/table/sql.html">SQL</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/table/functions.html">内置函数</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/table/sourceSinks.html">用户自定义源&接收器</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/table/udfs.html">用户自定义函数</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/table/sqlClient.html">SQL客户端</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-94" data-toggle="collapse">数据类型&序列化<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-94"><ul>
  <li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/types_serialization.html">概览</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/custom_serializers.html">自定义序列化器</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-97" data-toggle="collapse">管理执行<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-97"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/execution_configuration.html">执行配置</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/packaging.html">程序打包</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/parallel.html">并行执行</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/execution_plans.html">执行计划</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/restart_strategies.html">重启策略</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-104" data-toggle="collapse">类库<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-104"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/libs/cep.html">事件处理(CEP)</a></li>
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-106" data-toggle="collapse">图计算: Gelly<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-106"><ul>
  <li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/libs/gelly/">概览</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/libs/gelly/graph_api.html">Graph API</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/libs/gelly/iterative_graph_processing.html">Iterative Graph Processing</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/libs/gelly/library_methods.html">Library Methods</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/libs/gelly/graph_algorithms.html">Graph Algorithms</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/libs/gelly/graph_generators.html">Graph Generators</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/libs/gelly/bipartite_graph.html">Bipartite Graph</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-114" data-toggle="collapse">机器学习<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-114"><ul>
  <li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/libs/ml/">概览</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/libs/ml/quickstart.html">Quickstart</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/libs/ml/contribution_guide.html">How to Contribute</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/libs/ml/cross_validation.html">Cross Validation</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/libs/ml/distance_metrics.html">Distance Metrics</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/libs/ml/knn.html">k-Nearest Neighbors Join</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/libs/ml/min_max_scaler.html">MinMax Scaler</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/libs/ml/multiple_linear_regression.html">Multiple Linear Regression</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/libs/ml/pipelines.html">Pipelines</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/libs/ml/polynomial_features.html">Polynomial Features</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/libs/ml/sos.html">Stochastic Outlier Selection</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/libs/ml/standard_scaler.html">Standard Scaler</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/libs/ml/als.html">ALS</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/libs/ml/svm.html">SVM using CoCoA</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/best_practices.html">Best Practices</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/migration.html">API迁移指南</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-133" data-toggle="collapse"><i class="fa fa-sliders title maindish" aria-hidden="true"></i>部署 & 运维<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-133"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-134" data-toggle="collapse">集群 & 部署<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-134"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/ops/deployment/cluster_setup.html">Standalone Cluster</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/ops/deployment/yarn_setup.html">YARN</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/ops/deployment/mesos.html">Mesos</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/ops/deployment/kubernetes.html">Kubernetes</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/ops/deployment/docker.html">Docker</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/ops/deployment/aws.html">AWS</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/ops/deployment/gce_setup.html">Google Compute Engine</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/ops/deployment/mapr_setup.html">MapR</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/ops/deployment/hadoop.html">Hadoop Integration</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/ops/deployment/oss.html">Aliyun OSS</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/ops/jobmanager_high_availability.html">高可用(HA)</a></li>
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-147" data-toggle="collapse">状态&容错<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-147"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/ops/state/checkpoints.html">Checkpoints</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/ops/state/savepoints.html">Savepoints</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/ops/state/state_backends.html">状态后端</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/ops/state/large_state_tuning.html">Tuning Checkpoints and Large State</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/ops/config.html">配置</a></li>
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/ops/production_ready.html">生产准备清单</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/ops/cli.html">命令行界面</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/ops/scala_shell.html">Scala REPL(交互式解释器)</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/ops/security-kerberos.html">Kerberos</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/ops/security-ssl.html">SSL设置</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/ops/filesystems.html">文件系统</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/ops/upgrading.html">升级应用程序和Flink版本</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-162" data-toggle="collapse"><i class="fa fa-bug title maindish" aria-hidden="true"></i>调试 & 监控<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-162"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/monitoring/metrics.html">指标度量</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/monitoring/logging.html">日志</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/monitoring/historyserver.html">历史服务器</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/monitoring/checkpoint_monitoring.html">监控检查点</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/monitoring/back_pressure.html">监控背压</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/monitoring/rest_api.html">监控REST API</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/monitoring/debugging_event_time.html">调试Windows&Event Time</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/monitoring/debugging_classloading.html">调试类加载</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/monitoring/application_profiling.html">应用程序分析</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    <hr class="section-break"></hr>

    
    
      
      
        
        
<li><a href="#collapse-173" data-toggle="collapse"><i class="fa fa-cogs title dessert" aria-hidden="true"></i>Flink开发<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-173"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/flinkDev/ide_setup.html">将Flink导入IDE</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/flinkDev/building.html">从源码构建Flink</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-177" data-toggle="collapse"><i class="fa fa-book title dessert" aria-hidden="true"></i>内幕<i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-177"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/internals/components.html">Component Stack</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/internals/stream_checkpointing.html">Fault Tolerance for Data Streaming</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/internals/job_scheduling.html">Job作业和调度</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/internals/task_lifecycle.html">Task生命周期</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="//ci.apache.org/projects/flink/flink-docs-master/internals/filesystems.html">文件系统</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    
      
  <li class="divider"></li>
  <li><a href="//ci.apache.org/projects/flink/flink-docs-master/api/java"><i class="fa fa-external-link title" aria-hidden="true"></i> Javadocs</a></li>
  <li><a href="//ci.apache.org/projects/flink/flink-docs-master/api/scala/index.html#org.apache.flink.api.scala.package"><i class="fa fa-external-link title" aria-hidden="true"></i> Scaladocs</a></li>
  <li><a href="http://flink.apache.org"><i class="fa fa-external-link title" aria-hidden="true"></i> Project Page</a></li>
</ul>

<div class="sidenav-search-box">
  <form class="navbar-form" role="search" action="//ci.apache.org/projects/flink/flink-docs-master/search-results.html">
    <div class="form-group">
      <input type="text" class="form-control" size="16px" name="q" placeholder="Search">
    </div>
    <button type="submit" class="btn btn-default">Go</button>
  </form>
</div>

<div class="sidenav-versions">
  <div class="dropdown">
    <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown">Pick Docs Version
    <span class="caret"></span></button>
    <ul class="dropdown-menu">
      
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.7">v1.7</a></li>
      
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.6">v1.6</a></li>
      
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.5">v1.5</a></li>
      
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.4">v1.4</a></li>
      
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.3">v1.3</a></li>
      
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.2">v1.2</a></li>
      
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.1">v1.1</a></li>
      
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.0">v1.0</a></li>
      
    </ul>
  </div>
</div>

        </div>
        <div class="col-lg-9 content" id="contentcol">
          

          





  
  
    
    
      
    
  

  
  
    
    
      
    
  

  
  
    
    
      
    
  

  
  
    
    
      



<ol class="breadcrumb">

  
  
    <li><i class="fa fa-code title maindish" aria-hidden="true"></i> Application Development</li>
  

  
  
    <li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/datastream_api.html">Streaming (DataStream API)</a></li>
  

  
  
    <li><a href="//ci.apache.org/projects/flink/flink-docs-master/dev/connectors/">连接器</a></li>
  

  
  
    <li class="active">Elasticsearch</li>
  

</ol>

<h1>Elasticsearch Connector</h1>




<ul id="markdown-toc">
  <li><a href="#installing-elasticsearch" id="markdown-toc-installing-elasticsearch">Installing Elasticsearch</a></li>
  <li><a href="#elasticsearch-sink" id="markdown-toc-elasticsearch-sink">Elasticsearch Sink</a>    <ul>
      <li><a href="#elasticsearch-sinks-and-fault-tolerance" id="markdown-toc-elasticsearch-sinks-and-fault-tolerance">Elasticsearch Sinks and Fault Tolerance</a></li>
      <li><a href="#communication-using-embedded-node-only-for-elasticsearch-1x" id="markdown-toc-communication-using-embedded-node-only-for-elasticsearch-1x">Communication using Embedded Node (only for Elasticsearch 1.x)</a></li>
      <li><a href="#handling-failing-elasticsearch-requests" id="markdown-toc-handling-failing-elasticsearch-requests">Handling Failing Elasticsearch Requests</a></li>
      <li><a href="#configuring-the-internal-bulk-processor" id="markdown-toc-configuring-the-internal-bulk-processor">Configuring the Internal Bulk Processor</a></li>
    </ul>
  </li>
  <li><a href="#packaging-the-elasticsearch-connector-into-an-uber-jar" id="markdown-toc-packaging-the-elasticsearch-connector-into-an-uber-jar">Packaging the Elasticsearch Connector into an Uber-Jar</a></li>
</ul>

<p>This connector provides sinks that can request document actions to an
<a href="https://elastic.co/">Elasticsearch</a> Index. To use this connector, add one
of the following dependencies to your project, depending on the version
of the Elasticsearch installation:</p>

<table class="table table-bordered">
  <thead>
    <tr>
      <th class="text-left">Maven Dependency</th>
      <th class="text-left">Supported since</th>
      <th class="text-left">Elasticsearch version</th>
    </tr>
  </thead>
  <tbody>
    <tr>
        <td>flink-connector-elasticsearch_2.11</td>
        <td>1.0.0</td>
        <td>1.x</td>
    </tr>
    <tr>
        <td>flink-connector-elasticsearch2_2.11</td>
        <td>1.0.0</td>
        <td>2.x</td>
    </tr>
    <tr>
        <td>flink-connector-elasticsearch5_2.11</td>
        <td>1.3.0</td>
        <td>5.x</td>
    </tr>
    <tr>
        <td>flink-connector-elasticsearch6_2.11</td>
        <td>1.6.0</td>
        <td>6 and later versions</td>
    </tr>
  </tbody>
</table>

<p>Note that the streaming connectors are currently not part of the binary
distribution. See <a href="//ci.apache.org/projects/flink/flink-docs-master/dev/linking.html">here</a> for information
about how to package the program with the libraries for cluster execution.</p>

<h2 id="installing-elasticsearch">Installing Elasticsearch</h2>

<p>Instructions for setting up an Elasticsearch cluster can be found
<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/setup.html">here</a>.
Make sure to set and remember a cluster name. This must be set when
creating an <code class="highlighter-rouge">ElasticsearchSink</code> for requesting document actions against your cluster.</p>

<h2 id="elasticsearch-sink">Elasticsearch Sink</h2>

<p>The <code class="highlighter-rouge">ElasticsearchSink</code> uses a <code class="highlighter-rouge">TransportClient</code> (before 6.x) or <code class="highlighter-rouge">RestHighLevelClient</code> (starting with 6.x) to communicate with an
Elasticsearch cluster.</p>

<p>The example below shows how to configure and create a sink:</p>

<div class="codetabs">
  <div data-lang="java, Elasticsearch 1.x">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">import</span> <span class="nn">org.apache.flink.api.common.functions.RuntimeContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.streaming.api.datastream.DataStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.streaming.connectors.elasticsearch.ElasticsearchSink</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.streaming.connectors.elasticsearch.ElasticsearchSinkFunction</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.streaming.connectors.elasticsearch.RequestIndexer</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.elasticsearch.action.index.IndexRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.elasticsearch.client.Requests</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.elasticsearch.common.transport.InetSocketTransportAddress</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.elasticsearch.common.transport.TransportAddress</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.net.InetAddress</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>

<span class="n">DataStream</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">input</span> <span class="o">=</span> <span class="o">...;</span>

<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
<span class="n">config</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"cluster.name"</span><span class="o">,</span> <span class="s">"my-cluster-name"</span><span class="o">);</span>
<span class="c1">// This instructs the sink to emit after every element, otherwise they would be buffered</span>
<span class="n">config</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"bulk.flush.max.actions"</span><span class="o">,</span> <span class="s">"1"</span><span class="o">);</span>

<span class="n">List</span><span class="o">&lt;</span><span class="n">TransportAddress</span><span class="o">&gt;</span> <span class="n">transportAddresses</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
<span class="n">transportAddresses</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">InetSocketTransportAddress</span><span class="o">(</span><span class="s">"127.0.0.1"</span><span class="o">,</span> <span class="mi">9300</span><span class="o">));</span>
<span class="n">transportAddresses</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">InetSocketTransportAddress</span><span class="o">(</span><span class="s">"10.2.3.1"</span><span class="o">,</span> <span class="mi">9300</span><span class="o">));</span>

<span class="n">input</span><span class="o">.</span><span class="na">addSink</span><span class="o">(</span><span class="k">new</span> <span class="n">ElasticsearchSink</span><span class="o">&lt;&gt;(</span><span class="n">config</span><span class="o">,</span> <span class="n">transportAddresses</span><span class="o">,</span> <span class="k">new</span> <span class="n">ElasticsearchSinkFunction</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">IndexRequest</span> <span class="nf">createIndexRequest</span><span class="o">(</span><span class="n">String</span> <span class="n">element</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">json</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
        <span class="n">json</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"data"</span><span class="o">,</span> <span class="n">element</span><span class="o">);</span>
    
        <span class="k">return</span> <span class="n">Requests</span><span class="o">.</span><span class="na">indexRequest</span><span class="o">()</span>
                <span class="o">.</span><span class="na">index</span><span class="o">(</span><span class="s">"my-index"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">type</span><span class="o">(</span><span class="s">"my-type"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">source</span><span class="o">(</span><span class="n">json</span><span class="o">);</span>
    <span class="o">}</span>
    
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">process</span><span class="o">(</span><span class="n">String</span> <span class="n">element</span><span class="o">,</span> <span class="n">RuntimeContext</span> <span class="n">ctx</span><span class="o">,</span> <span class="n">RequestIndexer</span> <span class="n">indexer</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">indexer</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">createIndexRequest</span><span class="o">(</span><span class="n">element</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}));</span></code></pre></figure>

  </div>
  <div data-lang="java, Elasticsearch 2.x / 5.x">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">import</span> <span class="nn">org.apache.flink.api.common.functions.RuntimeContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.streaming.api.datastream.DataStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.streaming.connectors.elasticsearch.ElasticsearchSinkFunction</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.streaming.connectors.elasticsearch.RequestIndexer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.streaming.connectors.elasticsearch5.ElasticsearchSink</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.elasticsearch.action.index.IndexRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.elasticsearch.client.Requests</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.net.InetAddress</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.net.InetSocketAddress</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>

<span class="n">DataStream</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">input</span> <span class="o">=</span> <span class="o">...;</span>

<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
<span class="n">config</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"cluster.name"</span><span class="o">,</span> <span class="s">"my-cluster-name"</span><span class="o">);</span>
<span class="c1">// This instructs the sink to emit after every element, otherwise they would be buffered</span>
<span class="n">config</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"bulk.flush.max.actions"</span><span class="o">,</span> <span class="s">"1"</span><span class="o">);</span>

<span class="n">List</span><span class="o">&lt;</span><span class="n">InetSocketAddress</span><span class="o">&gt;</span> <span class="n">transportAddresses</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
<span class="n">transportAddresses</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">InetSocketAddress</span><span class="o">(</span><span class="n">InetAddress</span><span class="o">.</span><span class="na">getByName</span><span class="o">(</span><span class="s">"127.0.0.1"</span><span class="o">),</span> <span class="mi">9300</span><span class="o">));</span>
<span class="n">transportAddresses</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">InetSocketAddress</span><span class="o">(</span><span class="n">InetAddress</span><span class="o">.</span><span class="na">getByName</span><span class="o">(</span><span class="s">"10.2.3.1"</span><span class="o">),</span> <span class="mi">9300</span><span class="o">));</span>

<span class="n">input</span><span class="o">.</span><span class="na">addSink</span><span class="o">(</span><span class="k">new</span> <span class="n">ElasticsearchSink</span><span class="o">&lt;&gt;(</span><span class="n">config</span><span class="o">,</span> <span class="n">transportAddresses</span><span class="o">,</span> <span class="k">new</span> <span class="n">ElasticsearchSinkFunction</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">IndexRequest</span> <span class="nf">createIndexRequest</span><span class="o">(</span><span class="n">String</span> <span class="n">element</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">json</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
        <span class="n">json</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"data"</span><span class="o">,</span> <span class="n">element</span><span class="o">);</span>
    
        <span class="k">return</span> <span class="n">Requests</span><span class="o">.</span><span class="na">indexRequest</span><span class="o">()</span>
                <span class="o">.</span><span class="na">index</span><span class="o">(</span><span class="s">"my-index"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">type</span><span class="o">(</span><span class="s">"my-type"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">source</span><span class="o">(</span><span class="n">json</span><span class="o">);</span>
    <span class="o">}</span>
    
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">process</span><span class="o">(</span><span class="n">String</span> <span class="n">element</span><span class="o">,</span> <span class="n">RuntimeContext</span> <span class="n">ctx</span><span class="o">,</span> <span class="n">RequestIndexer</span> <span class="n">indexer</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">indexer</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">createIndexRequest</span><span class="o">(</span><span class="n">element</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}));</span></code></pre></figure>

  </div>
  <div data-lang="java, Elasticsearch 6.x">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">import</span> <span class="nn">org.apache.flink.api.common.functions.RuntimeContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.streaming.api.datastream.DataStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.streaming.connectors.elasticsearch.ElasticsearchSinkFunction</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.streaming.connectors.elasticsearch.RequestIndexer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.flink.streaming.connectors.elasticsearch6.ElasticsearchSink</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.http.HttpHost</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.elasticsearch.action.index.IndexRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.elasticsearch.client.Requests</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>

<span class="n">DataStream</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">input</span> <span class="o">=</span> <span class="o">...;</span>

<span class="n">List</span><span class="o">&lt;</span><span class="n">HttpHost</span><span class="o">&gt;</span> <span class="n">httpHosts</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
<span class="n">httpHosts</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">HttpHost</span><span class="o">(</span><span class="s">"127.0.0.1"</span><span class="o">,</span> <span class="mi">9200</span><span class="o">,</span> <span class="s">"http"</span><span class="o">));</span>
<span class="n">httpHosts</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">HttpHost</span><span class="o">(</span><span class="s">"10.2.3.1"</span><span class="o">,</span> <span class="mi">9200</span><span class="o">,</span> <span class="s">"http"</span><span class="o">));</span>

<span class="c1">// use a ElasticsearchSink.Builder to create an ElasticsearchSink</span>
<span class="n">ElasticsearchSink</span><span class="o">.</span><span class="na">Builder</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">esSinkBuilder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ElasticsearchSink</span><span class="o">.</span><span class="na">Builder</span><span class="o">&lt;&gt;(</span>
    <span class="n">httpHosts</span><span class="o">,</span>
    <span class="k">new</span> <span class="n">ElasticsearchSinkFunction</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="n">IndexRequest</span> <span class="nf">createIndexRequest</span><span class="o">(</span><span class="n">String</span> <span class="n">element</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">json</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
            <span class="n">json</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"data"</span><span class="o">,</span> <span class="n">element</span><span class="o">);</span>
        
            <span class="k">return</span> <span class="n">Requests</span><span class="o">.</span><span class="na">indexRequest</span><span class="o">()</span>
                    <span class="o">.</span><span class="na">index</span><span class="o">(</span><span class="s">"my-index"</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">type</span><span class="o">(</span><span class="s">"my-type"</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">source</span><span class="o">(</span><span class="n">json</span><span class="o">);</span>
        <span class="o">}</span>
        
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">process</span><span class="o">(</span><span class="n">String</span> <span class="n">element</span><span class="o">,</span> <span class="n">RuntimeContext</span> <span class="n">ctx</span><span class="o">,</span> <span class="n">RequestIndexer</span> <span class="n">indexer</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">indexer</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">createIndexRequest</span><span class="o">(</span><span class="n">element</span><span class="o">));</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">);</span>

<span class="c1">// configuration for the bulk requests; this instructs the sink to emit after every element, otherwise they would be buffered</span>
<span class="n">esSinkBuilder</span><span class="o">.</span><span class="na">setBulkFlushMaxActions</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>

<span class="c1">// provide a RestClientFactory for custom configuration on the internally created REST client</span>
<span class="n">esSinkBuilder</span><span class="o">.</span><span class="na">setRestClientFactory</span><span class="o">(</span>
  <span class="n">restClientBuilder</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">restClientBuilder</span><span class="o">.</span><span class="na">setDefaultHeaders</span><span class="o">(...)</span>
    <span class="n">restClientBuilder</span><span class="o">.</span><span class="na">setMaxRetryTimeoutMillis</span><span class="o">(...)</span>
    <span class="n">restClientBuilder</span><span class="o">.</span><span class="na">setPathPrefix</span><span class="o">(...)</span>
    <span class="n">restClientBuilder</span><span class="o">.</span><span class="na">setHttpClientConfigCallback</span><span class="o">(...)</span>
  <span class="o">}</span>
<span class="o">);</span>

<span class="c1">// finally, build and add the sink to the job's pipeline</span>
<span class="n">input</span><span class="o">.</span><span class="na">addSink</span><span class="o">(</span><span class="n">esSinkBuilder</span><span class="o">.</span><span class="na">build</span><span class="o">());</span></code></pre></figure>

  </div>
  <div data-lang="scala, Elasticsearch 1.x">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">import</span> <span class="nn">org.apache.flink.api.common.functions.RuntimeContext</span>
<span class="k">import</span> <span class="nn">org.apache.flink.streaming.api.datastream.DataStream</span>
<span class="k">import</span> <span class="nn">org.apache.flink.streaming.connectors.elasticsearch.ElasticsearchSink</span>
<span class="k">import</span> <span class="nn">org.apache.flink.streaming.connectors.elasticsearch.ElasticsearchSinkFunction</span>
<span class="k">import</span> <span class="nn">org.apache.flink.streaming.connectors.elasticsearch.RequestIndexer</span>

<span class="k">import</span> <span class="nn">org.elasticsearch.action.index.IndexRequest</span>
<span class="k">import</span> <span class="nn">org.elasticsearch.client.Requests</span>
<span class="k">import</span> <span class="nn">org.elasticsearch.common.transport.InetSocketTransportAddress</span>
<span class="k">import</span> <span class="nn">org.elasticsearch.common.transport.TransportAddress</span>

<span class="k">import</span> <span class="nn">java.net.InetAddress</span>
<span class="k">import</span> <span class="nn">java.util.ArrayList</span>
<span class="k">import</span> <span class="nn">java.util.HashMap</span>
<span class="k">import</span> <span class="nn">java.util.List</span>
<span class="k">import</span> <span class="nn">java.util.Map</span>

<span class="k">val</span> <span class="n">input</span><span class="k">:</span> <span class="kt">DataStream</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="o">...</span>

<span class="k">val</span> <span class="n">config</span> <span class="k">=</span> <span class="k">new</span> <span class="n">java</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="nc">HashMap</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">String</span><span class="o">]</span>
<span class="n">config</span><span class="o">.</span><span class="n">put</span><span class="o">(</span><span class="s">"cluster.name"</span><span class="o">,</span> <span class="s">"my-cluster-name"</span><span class="o">)</span>
<span class="c1">// This instructs the sink to emit after every element, otherwise they would be buffered
</span><span class="n">config</span><span class="o">.</span><span class="n">put</span><span class="o">(</span><span class="s">"bulk.flush.max.actions"</span><span class="o">,</span> <span class="s">"1"</span><span class="o">)</span>

<span class="k">val</span> <span class="n">transportAddresses</span> <span class="k">=</span> <span class="k">new</span> <span class="n">java</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="nc">ArrayList</span><span class="o">[</span><span class="kt">TransportAddress</span><span class="o">]</span>
<span class="n">transportAddresses</span><span class="o">.</span><span class="n">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">InetSocketTransportAddress</span><span class="o">(</span><span class="s">"127.0.0.1"</span><span class="o">,</span> <span class="mi">9300</span><span class="o">))</span>
<span class="n">transportAddresses</span><span class="o">.</span><span class="n">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">InetSocketTransportAddress</span><span class="o">(</span><span class="s">"10.2.3.1"</span><span class="o">,</span> <span class="mi">9300</span><span class="o">))</span>

<span class="n">input</span><span class="o">.</span><span class="n">addSink</span><span class="o">(</span><span class="k">new</span> <span class="nc">ElasticsearchSink</span><span class="o">(</span><span class="n">config</span><span class="o">,</span> <span class="n">transportAddresses</span><span class="o">,</span> <span class="k">new</span> <span class="nc">ElasticsearchSinkFunction</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">createIndexRequest</span><span class="o">(</span><span class="n">element</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">IndexRequest</span> <span class="o">=</span> <span class="o">{</span>
    <span class="k">val</span> <span class="n">json</span> <span class="k">=</span> <span class="k">new</span> <span class="n">java</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="nc">HashMap</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">String</span><span class="o">]</span>
    <span class="n">json</span><span class="o">.</span><span class="n">put</span><span class="o">(</span><span class="s">"data"</span><span class="o">,</span> <span class="n">element</span><span class="o">)</span>
    
    <span class="k">return</span> <span class="nc">Requests</span><span class="o">.</span><span class="n">indexRequest</span><span class="o">()</span>
            <span class="o">.</span><span class="n">index</span><span class="o">(</span><span class="s">"my-index"</span><span class="o">)</span>
            <span class="o">.</span><span class="n">type</span><span class="o">(</span><span class="s">"my-type"</span><span class="o">)</span>
            <span class="o">.</span><span class="n">source</span><span class="o">(</span><span class="n">json</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}))</span></code></pre></figure>

  </div>
  <div data-lang="scala, Elasticsearch 2.x / 5.x">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">import</span> <span class="nn">org.apache.flink.api.common.functions.RuntimeContext</span>
<span class="k">import</span> <span class="nn">org.apache.flink.streaming.api.datastream.DataStream</span>
<span class="k">import</span> <span class="nn">org.apache.flink.streaming.connectors.elasticsearch.ElasticsearchSinkFunction</span>
<span class="k">import</span> <span class="nn">org.apache.flink.streaming.connectors.elasticsearch.RequestIndexer</span>
<span class="k">import</span> <span class="nn">org.apache.flink.streaming.connectors.elasticsearch5.ElasticsearchSink</span>

<span class="k">import</span> <span class="nn">org.elasticsearch.action.index.IndexRequest</span>
<span class="k">import</span> <span class="nn">org.elasticsearch.client.Requests</span>

<span class="k">import</span> <span class="nn">java.net.InetAddress</span>
<span class="k">import</span> <span class="nn">java.net.InetSocketAddress</span>
<span class="k">import</span> <span class="nn">java.util.ArrayList</span>
<span class="k">import</span> <span class="nn">java.util.HashMap</span>
<span class="k">import</span> <span class="nn">java.util.List</span>
<span class="k">import</span> <span class="nn">java.util.Map</span>

<span class="k">val</span> <span class="n">input</span><span class="k">:</span> <span class="kt">DataStream</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="o">...</span>

<span class="k">val</span> <span class="n">config</span> <span class="k">=</span> <span class="k">new</span> <span class="n">java</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="nc">HashMap</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">String</span><span class="o">]</span>
<span class="n">config</span><span class="o">.</span><span class="n">put</span><span class="o">(</span><span class="s">"cluster.name"</span><span class="o">,</span> <span class="s">"my-cluster-name"</span><span class="o">)</span>
<span class="c1">// This instructs the sink to emit after every element, otherwise they would be buffered
</span><span class="n">config</span><span class="o">.</span><span class="n">put</span><span class="o">(</span><span class="s">"bulk.flush.max.actions"</span><span class="o">,</span> <span class="s">"1"</span><span class="o">)</span>

<span class="k">val</span> <span class="n">transportAddresses</span> <span class="k">=</span> <span class="k">new</span> <span class="n">java</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="nc">ArrayList</span><span class="o">[</span><span class="kt">InetSocketAddress</span><span class="o">]</span>
<span class="n">transportAddresses</span><span class="o">.</span><span class="n">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">InetSocketAddress</span><span class="o">(</span><span class="nc">InetAddress</span><span class="o">.</span><span class="n">getByName</span><span class="o">(</span><span class="s">"127.0.0.1"</span><span class="o">),</span> <span class="mi">9300</span><span class="o">))</span>
<span class="n">transportAddresses</span><span class="o">.</span><span class="n">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">InetSocketAddress</span><span class="o">(</span><span class="nc">InetAddress</span><span class="o">.</span><span class="n">getByName</span><span class="o">(</span><span class="s">"10.2.3.1"</span><span class="o">),</span> <span class="mi">9300</span><span class="o">))</span>

<span class="n">input</span><span class="o">.</span><span class="n">addSink</span><span class="o">(</span><span class="k">new</span> <span class="nc">ElasticsearchSink</span><span class="o">(</span><span class="n">config</span><span class="o">,</span> <span class="n">transportAddresses</span><span class="o">,</span> <span class="k">new</span> <span class="nc">ElasticsearchSinkFunction</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">createIndexRequest</span><span class="o">(</span><span class="n">element</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">IndexRequest</span> <span class="o">=</span> <span class="o">{</span>
    <span class="k">val</span> <span class="n">json</span> <span class="k">=</span> <span class="k">new</span> <span class="n">java</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="nc">HashMap</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">String</span><span class="o">]</span>
    <span class="n">json</span><span class="o">.</span><span class="n">put</span><span class="o">(</span><span class="s">"data"</span><span class="o">,</span> <span class="n">element</span><span class="o">)</span>
    
    <span class="k">return</span> <span class="nc">Requests</span><span class="o">.</span><span class="n">indexRequest</span><span class="o">()</span>
            <span class="o">.</span><span class="n">index</span><span class="o">(</span><span class="s">"my-index"</span><span class="o">)</span>
            <span class="o">.</span><span class="n">type</span><span class="o">(</span><span class="s">"my-type"</span><span class="o">)</span>
            <span class="o">.</span><span class="n">source</span><span class="o">(</span><span class="n">json</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}))</span></code></pre></figure>

  </div>
  <div data-lang="scala, Elasticsearch 6.x">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">import</span> <span class="nn">org.apache.flink.api.common.functions.RuntimeContext</span>
<span class="k">import</span> <span class="nn">org.apache.flink.streaming.api.datastream.DataStream</span>
<span class="k">import</span> <span class="nn">org.apache.flink.streaming.connectors.elasticsearch.ElasticsearchSinkFunction</span>
<span class="k">import</span> <span class="nn">org.apache.flink.streaming.connectors.elasticsearch.RequestIndexer</span>
<span class="k">import</span> <span class="nn">org.apache.flink.streaming.connectors.elasticsearch6.ElasticsearchSink</span>

<span class="k">import</span> <span class="nn">org.apache.http.HttpHost</span>
<span class="k">import</span> <span class="nn">org.elasticsearch.action.index.IndexRequest</span>
<span class="k">import</span> <span class="nn">org.elasticsearch.client.Requests</span>

<span class="k">import</span> <span class="nn">java.util.ArrayList</span>
<span class="k">import</span> <span class="nn">java.util.List</span>

<span class="k">val</span> <span class="n">input</span><span class="k">:</span> <span class="kt">DataStream</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="o">...</span>

<span class="k">val</span> <span class="n">httpHosts</span> <span class="k">=</span> <span class="k">new</span> <span class="n">java</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="nc">ArrayList</span><span class="o">[</span><span class="kt">HttpHost</span><span class="o">]</span>
<span class="n">httpHosts</span><span class="o">.</span><span class="n">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">HttpHost</span><span class="o">(</span><span class="s">"127.0.0.1"</span><span class="o">,</span> <span class="mi">9200</span><span class="o">,</span> <span class="s">"http"</span><span class="o">))</span>
<span class="n">httpHosts</span><span class="o">.</span><span class="n">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">HttpHost</span><span class="o">(</span><span class="s">"10.2.3.1"</span><span class="o">,</span> <span class="mi">9200</span><span class="o">,</span> <span class="s">"http"</span><span class="o">))</span>

<span class="k">val</span> <span class="n">esSinkBuilder</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ElasticsearchSink</span><span class="o">.</span><span class="nc">Builer</span><span class="o">[</span><span class="kt">String</span><span class="o">](</span>
  <span class="n">httpHosts</span><span class="o">,</span>
  <span class="k">new</span> <span class="nc">ElasticsearchSinkFunction</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">createIndexRequest</span><span class="o">(</span><span class="n">element</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">IndexRequest</span> <span class="o">=</span> <span class="o">{</span>
      <span class="k">val</span> <span class="n">json</span> <span class="k">=</span> <span class="k">new</span> <span class="n">java</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="nc">HashMap</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">String</span><span class="o">]</span>
      <span class="n">json</span><span class="o">.</span><span class="n">put</span><span class="o">(</span><span class="s">"data"</span><span class="o">,</span> <span class="n">element</span><span class="o">)</span>
      
      <span class="k">return</span> <span class="nc">Requests</span><span class="o">.</span><span class="n">indexRequest</span><span class="o">()</span>
              <span class="o">.</span><span class="n">index</span><span class="o">(</span><span class="s">"my-index"</span><span class="o">)</span>
              <span class="o">.</span><span class="n">type</span><span class="o">(</span><span class="s">"my-type"</span><span class="o">)</span>
              <span class="o">.</span><span class="n">source</span><span class="o">(</span><span class="n">json</span><span class="o">)</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">)</span>

<span class="c1">// configuration for the bulk requests; this instructs the sink to emit after every element, otherwise they would be buffered
</span><span class="n">esSinkBuilder</span><span class="o">.</span><span class="n">setBulkFlushMaxActions</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>

<span class="c1">// provide a RestClientFactory for custom configuration on the internally created REST client
</span><span class="n">esSinkBuilder</span><span class="o">.</span><span class="n">setRestClientFactory</span><span class="o">(</span>
  <span class="n">restClientBuilder</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">restClientBuilder</span><span class="o">.</span><span class="n">setDefaultHeaders</span><span class="o">(...)</span>
    <span class="n">restClientBuilder</span><span class="o">.</span><span class="n">setMaxRetryTimeoutMillis</span><span class="o">(...)</span>
    <span class="n">restClientBuilder</span><span class="o">.</span><span class="n">setPathPrefix</span><span class="o">(...)</span>
    <span class="n">restClientBuilder</span><span class="o">.</span><span class="n">setHttpClientConfigCallback</span><span class="o">(...)</span>
  <span class="o">}</span>
<span class="o">)</span>

<span class="c1">// finally, build and add the sink to the job's pipeline
</span><span class="n">input</span><span class="o">.</span><span class="n">addSink</span><span class="o">(</span><span class="n">esSinkBuilder</span><span class="o">.</span><span class="n">build</span><span class="o">)</span></code></pre></figure>

  </div>
</div>

<p>For Elasticsearch versions that still uses the now deprecated <code class="highlighter-rouge">TransportClient</code> to communicate
with the Elasticsearch cluster (i.e., versions equal or below 5.x), note how a <code class="highlighter-rouge">Map</code> of <code class="highlighter-rouge">String</code>s
is used to configure the <code class="highlighter-rouge">ElasticsearchSink</code>. This config map will be directly
forwarded when creating the internally used <code class="highlighter-rouge">TransportClient</code>.
The configuration keys are documented in the Elasticsearch documentation
<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html">here</a>.
Especially important is the <code class="highlighter-rouge">cluster.name</code> parameter that must correspond to
the name of your cluster.</p>

<p>For Elasticsearch 6.x and above, internally, the <code class="highlighter-rouge">RestHighLevelClient</code> is used for cluster communication.
By default, the connector uses the default configurations for the REST client. To have custom
configuration for the REST client, users can provide a <code class="highlighter-rouge">RestClientFactory</code> implementation when 
setting up the <code class="highlighter-rouge">ElasticsearchClient.Builder</code> that builds the sink.</p>

<p>Also note that the example only demonstrates performing a single index
request for each incoming element. Generally, the <code class="highlighter-rouge">ElasticsearchSinkFunction</code>
can be used to perform multiple requests of different types (ex.,
<code class="highlighter-rouge">DeleteRequest</code>, <code class="highlighter-rouge">UpdateRequest</code>, etc.).</p>

<p>Internally, each parallel instance of the Flink Elasticsearch Sink uses
a <code class="highlighter-rouge">BulkProcessor</code> to send action requests to the cluster.
This will buffer elements before sending them in bulk to the cluster. The <code class="highlighter-rouge">BulkProcessor</code>
executes bulk requests one at a time, i.e. there will be no two concurrent
flushes of the buffered actions in progress.</p>

<h3 id="elasticsearch-sinks-and-fault-tolerance">Elasticsearch Sinks and Fault Tolerance</h3>

<p>With Flink’s checkpointing enabled, the Flink Elasticsearch Sink guarantees
at-least-once delivery of action requests to Elasticsearch clusters. It does
so by waiting for all pending action requests in the <code class="highlighter-rouge">BulkProcessor</code> at the
time of checkpoints. This effectively assures that all requests before the
checkpoint was triggered have been successfully acknowledged by Elasticsearch, before
proceeding to process more records sent to the sink.</p>

<p>More details on checkpoints and fault tolerance are in the <a href="//ci.apache.org/projects/flink/flink-docs-master/internals/stream_checkpointing.html">fault tolerance docs</a>.</p>

<p>To use fault tolerant Elasticsearch Sinks, checkpointing of the topology needs to be enabled at the execution environment:</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">final</span> <span class="n">StreamExecutionEnvironment</span> <span class="n">env</span> <span class="o">=</span> <span class="n">StreamExecutionEnvironment</span><span class="o">.</span><span class="na">getExecutionEnvironment</span><span class="o">();</span>
<span class="n">env</span><span class="o">.</span><span class="na">enableCheckpointing</span><span class="o">(</span><span class="mi">5000</span><span class="o">);</span> <span class="c1">// checkpoint every 5000 msecs</span></code></pre></figure>

  </div>
  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">env</span> <span class="k">=</span> <span class="nc">StreamExecutionEnvironment</span><span class="o">.</span><span class="n">getExecutionEnvironment</span><span class="o">()</span>
<span class="n">env</span><span class="o">.</span><span class="n">enableCheckpointing</span><span class="o">(</span><span class="mi">5000</span><span class="o">)</span> <span class="o">//</span> <span class="n">checkpoint</span> <span class="n">every</span> <span class="mi">5000</span> <span class="n">msecs</span></code></pre></figure>

  </div>
</div>

<p style="border-radius: 5px; padding: 5px" class="bg-danger">
<b>NOTE</b>: Users can disable flushing if they wish to do so, by calling
<b>disableFlushOnCheckpoint()</b> on the created <b>ElasticsearchSink</b>. Be aware
that this essentially means the sink will not provide any strong
delivery guarantees anymore, even with checkpoint for the topology enabled.
</p>

<h3 id="communication-using-embedded-node-only-for-elasticsearch-1x">Communication using Embedded Node (only for Elasticsearch 1.x)</h3>

<p>For Elasticsearch versions 1.x, communication using an embedded node is
also supported. See <a href="https://www.elastic.co/guide/en/elasticsearch/client/java-api/current/client.html">here</a>
for information about the differences between communicating with Elasticsearch
with an embedded node and a <code class="highlighter-rouge">TransportClient</code>.</p>

<p>Below is an example of how to create an <code class="highlighter-rouge">ElasticsearchSink</code> use an
embedded node instead of a <code class="highlighter-rouge">TransportClient</code>:</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">DataStream</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">input</span> <span class="o">=</span> <span class="o">...;</span>

<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;;</span>
<span class="c1">// This instructs the sink to emit after every element, otherwise they would be buffered</span>
<span class="n">config</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"bulk.flush.max.actions"</span><span class="o">,</span> <span class="s">"1"</span><span class="o">);</span>
<span class="n">config</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"cluster.name"</span><span class="o">,</span> <span class="s">"my-cluster-name"</span><span class="o">);</span>

<span class="n">input</span><span class="o">.</span><span class="na">addSink</span><span class="o">(</span><span class="k">new</span> <span class="n">ElasticsearchSink</span><span class="o">&lt;&gt;(</span><span class="n">config</span><span class="o">,</span> <span class="k">new</span> <span class="n">ElasticsearchSinkFunction</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">IndexRequest</span> <span class="nf">createIndexRequest</span><span class="o">(</span><span class="n">String</span> <span class="n">element</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">json</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
        <span class="n">json</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"data"</span><span class="o">,</span> <span class="n">element</span><span class="o">);</span>
    
        <span class="k">return</span> <span class="n">Requests</span><span class="o">.</span><span class="na">indexRequest</span><span class="o">()</span>
                <span class="o">.</span><span class="na">index</span><span class="o">(</span><span class="s">"my-index"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">type</span><span class="o">(</span><span class="s">"my-type"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">source</span><span class="o">(</span><span class="n">json</span><span class="o">);</span>
    <span class="o">}</span>
    
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">process</span><span class="o">(</span><span class="n">String</span> <span class="n">element</span><span class="o">,</span> <span class="n">RuntimeContext</span> <span class="n">ctx</span><span class="o">,</span> <span class="n">RequestIndexer</span> <span class="n">indexer</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">indexer</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">createIndexRequest</span><span class="o">(</span><span class="n">element</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}));</span></code></pre></figure>

  </div>
  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">input</span><span class="k">:</span> <span class="kt">DataStream</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="o">...</span>

<span class="k">val</span> <span class="n">config</span> <span class="k">=</span> <span class="k">new</span> <span class="n">java</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="nc">HashMap</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">String</span><span class="o">]</span>
<span class="n">config</span><span class="o">.</span><span class="n">put</span><span class="o">(</span><span class="s">"bulk.flush.max.actions"</span><span class="o">,</span> <span class="s">"1"</span><span class="o">)</span>
<span class="n">config</span><span class="o">.</span><span class="n">put</span><span class="o">(</span><span class="s">"cluster.name"</span><span class="o">,</span> <span class="s">"my-cluster-name"</span><span class="o">)</span>

<span class="n">input</span><span class="o">.</span><span class="n">addSink</span><span class="o">(</span><span class="k">new</span> <span class="nc">ElasticsearchSink</span><span class="o">(</span><span class="n">config</span><span class="o">,</span> <span class="k">new</span> <span class="nc">ElasticsearchSinkFunction</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">createIndexRequest</span><span class="o">(</span><span class="n">element</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">IndexRequest</span> <span class="o">=</span> <span class="o">{</span>
    <span class="k">val</span> <span class="n">json</span> <span class="k">=</span> <span class="k">new</span> <span class="n">java</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="nc">HashMap</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">String</span><span class="o">]</span>
    <span class="n">json</span><span class="o">.</span><span class="n">put</span><span class="o">(</span><span class="s">"data"</span><span class="o">,</span> <span class="n">element</span><span class="o">)</span>
    
    <span class="k">return</span> <span class="nc">Requests</span><span class="o">.</span><span class="n">indexRequest</span><span class="o">()</span>
            <span class="o">.</span><span class="n">index</span><span class="o">(</span><span class="s">"my-index"</span><span class="o">)</span>
            <span class="o">.</span><span class="n">type</span><span class="o">(</span><span class="s">"my-type"</span><span class="o">)</span>
            <span class="o">.</span><span class="n">source</span><span class="o">(</span><span class="n">json</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}))</span></code></pre></figure>

  </div>
</div>

<p>The difference is that now we do not need to provide a list of addresses
of Elasticsearch nodes.</p>

<h3 id="handling-failing-elasticsearch-requests">Handling Failing Elasticsearch Requests</h3>

<p>Elasticsearch action requests may fail due to a variety of reasons, including
temporarily saturated node queue capacity or malformed documents to be indexed.
The Flink Elasticsearch Sink allows the user to specify how request
failures are handled, by simply implementing an <code class="highlighter-rouge">ActionRequestFailureHandler</code> and
providing it to the constructor.</p>

<p>Below is an example:</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">DataStream</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">input</span> <span class="o">=</span> <span class="o">...;</span>

<span class="n">input</span><span class="o">.</span><span class="na">addSink</span><span class="o">(</span><span class="k">new</span> <span class="n">ElasticsearchSink</span><span class="o">&lt;&gt;(</span>
    <span class="n">config</span><span class="o">,</span> <span class="n">transportAddresses</span><span class="o">,</span>
    <span class="k">new</span> <span class="n">ElasticsearchSinkFunction</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{...},</span>
    <span class="k">new</span> <span class="nf">ActionRequestFailureHandler</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kt">void</span> <span class="nf">onFailure</span><span class="o">(</span><span class="n">ActionRequest</span> <span class="n">action</span><span class="o">,</span>
                <span class="n">Throwable</span> <span class="n">failure</span><span class="o">,</span>
                <span class="kt">int</span> <span class="n">restStatusCode</span><span class="o">,</span>
                <span class="n">RequestIndexer</span> <span class="n">indexer</span><span class="o">)</span> <span class="k">throw</span> <span class="n">Throwable</span> <span class="o">{</span>

            <span class="k">if</span> <span class="o">(</span><span class="n">ExceptionUtils</span><span class="o">.</span><span class="na">containsThrowable</span><span class="o">(</span><span class="n">failure</span><span class="o">,</span> <span class="n">EsRejectedExecutionException</span><span class="o">.</span><span class="na">class</span><span class="o">))</span> <span class="o">{</span>
                <span class="c1">// full queue; re-add document for indexing</span>
                <span class="n">indexer</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">action</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">ExceptionUtils</span><span class="o">.</span><span class="na">containsThrowable</span><span class="o">(</span><span class="n">failure</span><span class="o">,</span> <span class="n">ElasticsearchParseException</span><span class="o">.</span><span class="na">class</span><span class="o">))</span> <span class="o">{</span>
                <span class="c1">// malformed document; simply drop request without failing sink</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="c1">// for all other failures, fail the sink</span>
                <span class="c1">// here the failure is simply rethrown, but users can also choose to throw custom exceptions</span>
                <span class="k">throw</span> <span class="n">failure</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
<span class="o">}));</span></code></pre></figure>

  </div>
  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">input</span><span class="k">:</span> <span class="kt">DataStream</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="o">...</span>

<span class="n">input</span><span class="o">.</span><span class="n">addSink</span><span class="o">(</span><span class="k">new</span> <span class="nc">ElasticsearchSink</span><span class="o">(</span>
    <span class="n">config</span><span class="o">,</span> <span class="n">transportAddresses</span><span class="o">,</span>
    <span class="k">new</span> <span class="nc">ElasticsearchSinkFunction</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="o">{...},</span>
    <span class="k">new</span> <span class="nc">ActionRequestFailureHandler</span> <span class="o">{</span>
        <span class="nd">@throws</span><span class="o">(</span><span class="n">classOf</span><span class="o">[</span><span class="kt">Throwable</span><span class="o">])</span>
        <span class="k">override</span> <span class="k">def</span> <span class="n">onFailure</span><span class="o">(</span><span class="nc">ActionRequest</span> <span class="n">action</span><span class="o">,</span>
                <span class="nc">Throwable</span> <span class="n">failure</span><span class="o">,</span>
                <span class="n">int</span> <span class="n">restStatusCode</span><span class="o">,</span>
                <span class="nc">RequestIndexer</span> <span class="n">indexer</span><span class="o">)</span> <span class="o">{</span>

            <span class="k">if</span> <span class="o">(</span><span class="nc">ExceptionUtils</span><span class="o">.</span><span class="n">containsThrowable</span><span class="o">(</span><span class="n">failure</span><span class="o">,</span> <span class="nc">EsRejectedExecutionException</span><span class="o">.</span><span class="n">class</span><span class="o">))</span> <span class="o">{</span>
                <span class="c1">// full queue; re-add document for indexing
</span>                <span class="n">indexer</span><span class="o">.</span><span class="n">add</span><span class="o">(</span><span class="n">action</span><span class="o">)</span>
            <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="nc">ExceptionUtils</span><span class="o">.</span><span class="n">containsThrowable</span><span class="o">(</span><span class="n">failure</span><span class="o">,</span> <span class="nc">ElasticsearchParseException</span><span class="o">.</span><span class="n">class</span><span class="o">))</span> <span class="o">{</span>
                <span class="c1">// malformed document; simply drop request without failing sink
</span>            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="c1">// for all other failures, fail the sink
</span>                <span class="c1">// here the failure is simply rethrown, but users can also choose to throw custom exceptions
</span>                <span class="k">throw</span> <span class="n">failure</span>
            <span class="o">}</span>
        <span class="o">}</span>
<span class="o">}))</span></code></pre></figure>

  </div>
</div>

<p>The above example will let the sink re-add requests that failed due to
queue capacity saturation and drop requests with malformed documents, without
failing the sink. For all other failures, the sink will fail. If a <code class="highlighter-rouge">ActionRequestFailureHandler</code>
is not provided to the constructor, the sink will fail for any kind of error.</p>

<p>Note that <code class="highlighter-rouge">onFailure</code> is called for failures that still occur only after the
<code class="highlighter-rouge">BulkProcessor</code> internally finishes all backoff retry attempts.
By default, the <code class="highlighter-rouge">BulkProcessor</code> retries to a maximum of 8 attempts with
an exponential backoff. For more information on the behaviour of the
internal <code class="highlighter-rouge">BulkProcessor</code> and how to configure it, please see the following section.</p>

<p>By default, if a failure handler is not provided, the sink uses a
<code class="highlighter-rouge">NoOpFailureHandler</code> that simply fails for all kinds of exceptions. The
connector also provides a <code class="highlighter-rouge">RetryRejectedExecutionFailureHandler</code> implementation
that always re-add requests that have failed due to queue capacity saturation.</p>

<p style="border-radius: 5px; padding: 5px" class="bg-danger">
<b>IMPORTANT</b>: Re-adding requests back to the internal <b>BulkProcessor</b>
on failures will lead to longer checkpoints, as the sink will also
need to wait for the re-added requests to be flushed when checkpointing.
For example, when using <b>RetryRejectedExecutionFailureHandler</b>, checkpoints
will need to wait until Elasticsearch node queues have enough capacity for
all the pending requests. This also means that if re-added requests never
succeed, the checkpoint will never finish.
</p>

<p style="border-radius: 5px; padding: 5px" class="bg-warning">
<b>Failure handling for Elasticsearch 1.x</b>: For Elasticsearch 1.x, it
is not feasible to match the type of the failure because the exact type
could not be retrieved through the older version Java client APIs (thus,
the types will be general <b>Exception</b>s and only differ in the
failure message). In this case, it is recommended to match on the
provided REST status code.
</p>

<h3 id="configuring-the-internal-bulk-processor">Configuring the Internal Bulk Processor</h3>

<p>The internal <code class="highlighter-rouge">BulkProcessor</code> can be further configured for its behaviour
on how buffered action requests are flushed, by setting the following values in
the provided <code class="highlighter-rouge">Map&lt;String, String&gt;</code>:</p>

<ul>
  <li><strong>bulk.flush.max.actions</strong>: Maximum amount of actions to buffer before flushing.</li>
  <li><strong>bulk.flush.max.size.mb</strong>: Maximum size of data (in megabytes) to buffer before flushing.</li>
  <li><strong>bulk.flush.interval.ms</strong>: Interval at which to flush regardless of the amount or size of buffered actions.</li>
</ul>

<p>For versions 2.x and above, configuring how temporary request errors are
retried is also supported:</p>

<ul>
  <li><strong>bulk.flush.backoff.enable</strong>: Whether or not to perform retries with backoff delay for a flush
 if one or more of its actions failed due to a temporary <code class="highlighter-rouge">EsRejectedExecutionException</code>.</li>
  <li><strong>bulk.flush.backoff.type</strong>: The type of backoff delay, either <code class="highlighter-rouge">CONSTANT</code> or <code class="highlighter-rouge">EXPONENTIAL</code></li>
  <li><strong>bulk.flush.backoff.delay</strong>: The amount of delay for backoff. For constant backoff, this
 is simply the delay between each retry. For exponential backoff, this is the initial base delay.</li>
  <li><strong>bulk.flush.backoff.retries</strong>: The amount of backoff retries to attempt.</li>
</ul>

<p>More information about Elasticsearch can be found <a href="https://elastic.co">here</a>.</p>

<h2 id="packaging-the-elasticsearch-connector-into-an-uber-jar">Packaging the Elasticsearch Connector into an Uber-Jar</h2>

<p>For the execution of your Flink program, it is recommended to build a
so-called uber-jar (executable jar) containing all your dependencies
(see <a href="//ci.apache.org/projects/flink/flink-docs-master/dev/linking.html">here</a> for further information).</p>

<p>Alternatively, you can put the connector’s jar file into Flink’s <code class="highlighter-rouge">lib/</code> folder to make it available
system-wide, i.e. for all job being run.</p>

<p><a href="#top" class="top pull-right"><span class="glyphicon glyphicon-chevron-up"></span> Back to top</a></p>


        </div>
      </div>
    </div><!-- /.container -->

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="//ci.apache.org/projects/flink/flink-docs-master/page/js/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/3.1.0/anchor.min.js"></script>
    <script src="//ci.apache.org/projects/flink/flink-docs-master/page/js/flink.js"></script>

    <!-- Google Analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-52545728-1', 'auto');
      ga('send', 'pageview');
    </script>

    <!-- Disqus -->
    
  </body>
</html>
